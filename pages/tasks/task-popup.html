<link rel="import" href="../../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../../bower_components/paper-input/paper-autogrow-textarea.html">
<link rel="import" href="../../bower_components/paper-toast/paper-toast.html">
<link rel="import" href="../../elements/pikaday-element/pickaday-element.html">

<polymer-element name="task-popup">
    <template>
        <task-repo id="repo"></task-repo>
        <paper-dialog backdrop id="newItemPopup" heading="New Task">
            <style>
                paper-input, pickaday-element::shadow paper-input {
                    width: 100%;
                    display: block;
                }

                paper-input /deep/ paper-input,
                paper-input /deep/ .label,
                paper-input /deep/ input {
                    margin: 0;
                    padding: 0;
                }

                paper-dialog /deep/ textarea {
                    padding: 5px !important;
                    border: 1px solid #898989 !important;
                    width: 100% !important;
                    display: block !important;
                    min-width: 200px;
                    min-height: 100px;
                }
            </style>
            <paper-input type="text" label="Task" value="{{newItemModel.Details}}"></paper-input>
            <pickaday-element label="Deadline" id="pickDeadline"></pickaday-element>
            <p>
                <paper-button class="default-primary-color" raised on-tap="{{createTask}}">Create</paper-button>
            </p>
        </paper-dialog>
        <paper-toast id="toastError" text=""></paper-toast>
        <paper-toast id="toastSuccess" text=""></paper-toast>
    </template>
    <script>
        Polymer('task-popup', {
            newItemModel: {},
            observe: {
                '$.pickDeadline.inputVal': 'dateChangedCallback'
            },
            createTask: function () {
                this.$.repo.createTask(this.createTaskCallback, this.newItemModel, this);
            },
            dateChangedCallback: function () {
                this.newItemModel.Deadline = this.$.pickDeadline.inputVal;
            },
            createTaskCallback: function (success, errors, self) {
                if (success) {
                    self.$.newItemPopup.close();
                    self.$.toastSuccess.text = "Task Created";
                    self.$.toastSuccess.show();
                    self.fire('task-created');
                } else {
                    var errorVals = [];
                    errors.forEach(function (err) {
                        errorVals.push(err.error);
                    });
                    self.$.toastError.text = errorVals.join(', ');
                    self.$.toastError.show();
                }
            },
            newItem: function () {
                this.newItemModel = {Details: "", Deadline: ""};
                this.$.newItemPopup.toggle();
            }
        });
    </script>
</polymer-element>